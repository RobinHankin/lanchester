---
title: "A Markoff chain approach to naval warfare"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("hyper2")
library("partitions")
library("pdftools")
```

<p style="text-align: right;">
![](`r system.file("help/figures/hyper2.png", package = "hyper2")`){width=10%}
</p>

OK

```{r dosomef,cache=TRUE}
f <- function(a,b){
  if(a==0){return(0)}
  if(b==0){return(1)}
  if(a==b){return(1/2)}
  p <- a/(a+b)
  return(p*f(a,b-1) + (1-p)*f(a-1,b))
}

f(3,2) - 31/40
f(4,2) - 331/360
f(4,3) - 233/315
f(6,6)
f(6,7)
f(10,11)
```



```{tikz, fig.cap = "Partial probability tree for five competitors $a-e$ with $a$ supporting $b$, hyper3 approach", fig.ext = 'png', echo=FALSE}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{patterns}
\newcommand{\arrowIn}{
\tikz \draw[-{Latex[length=4mm]}] (-1pt,0) -- (1pt,0);
}

\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=3cm,y=3cm]

%\fill (0,0) circle[radius=4pt];  % the origin
\fill (1,0) circle[radius=6pt];
\fill (2,0) circle[radius=6pt];
\fill (3,0) circle[radius=6pt];
\fill (4,0) circle[radius=6pt];

\fill (0,1) circle[radius=6pt];
\fill (1,1) circle[radius=3pt];
\fill (2,1) circle[radius=3pt];
\fill (3,1) circle[radius=3pt];
\fill (4,1) circle[radius=3pt];

\fill (0,2) circle[radius=6pt];
\fill (1,2) circle[radius=2pt];
\fill (2,2) circle[radius=2pt];
\fill (3,2) circle[radius=2pt];
\fill (4,2) circle[radius=2pt];

\fill (0,3) circle[radius=6pt];
\fill (1,3) circle[radius=2pt];
\fill (2,3) circle[radius=2pt];
\fill (3,3) circle[radius=2pt];
\fill (4,3) circle[radius=2pt];

% horizontal lines first:

%\draw[line width=0.5mm] (1,0) -- (0,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (2,0) -- (1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (3,0) -- (2,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (4,0) -- (3,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,1) -- (0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,1) -- (1,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,1) -- (2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,1) -- (3,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,2) -- (0,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,2) -- (1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,2) -- (2,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,2) -- (3,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,3) -- (0,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,3) -- (1,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,3) -- (2,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,3) -- (3,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;


% Now vertical lines:
%\draw[line width=0.5mm] (0,1) -- (0,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (0,2) -- (0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (0,3) -- (0,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,1) -- (1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (1,2) -- (1,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (1,3) -- (1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (2,1) -- (2,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,2) -- (2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,3) -- (2,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (3,1) -- (3,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,2) -- (3,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,3) -- (3,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (4,1) -- (4,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,2) -- (4,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,3) -- (4,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;


%\node at (0.2, 0.1)  {$(0,0)$};
\node[text=blue] at (1.2, 0.1)  {$(1,0)$};
\node[text=blue] at (2.2, 0.1)  {$(2,0)$};
\node[text=blue] at (3.2, 0.1)  {$(3,0)$};
\node[text=blue] at (4.2, 0.1)  {$(4,0)$};

\node[text=blue] at (0.2, 1.1)  {$(0,1)$};
\node[text=blue] at (1.2, 1.1)  {$(1,1)$};
\node[text=blue] at (2.2, 1.1)  {$(2,1)$};
\node[text=blue] at (3.2, 1.1)  {$(3,1)$};
\node[text=blue] at (4.2, 1.1)  {$(4,1)$};

\node[text=blue] at (0.2, 2.1)  {$(0,2)$};
\node[text=blue] at (1.2, 2.1)  {$(1,2)$};
\node[text=blue] at (2.2, 2.1)  {$(2,2)$};
\node[text=blue] at (3.2, 2.1)  {$(3,2)$};
\node[text=blue] at (4.2, 2.1)  {$(4,2)$};

\node[text=blue] at (0.2, 3.1)  {$(0,3)$};
\node[text=blue] at (1.2, 3.1)  {$(1,3)$};
\node[text=blue] at (2.2, 3.1)  {$(2,3)$};
\node[text=blue] at (3.2, 3.1)  {$(3,3)$};
\node[text=blue] at (4.2, 3.1)  {$(4,3)$};

%  probs for horizontal lines:
\node[text=teal] at (0.5, 0.85)  {$\frac{1}{1+1}$};
\node[text=teal] at (1.5, 0.85)  {$\frac{1}{2+1}$};
\node[text=teal] at (2.5, 0.85)  {$\frac{1}{3+1}$};
\node[text=teal] at (3.5, 0.85)  {$\frac{1}{4+1}$};

\node[text=teal] at (0.5, 1.85)  {$\frac{2}{1+2}$};
\node[text=teal] at (1.5, 1.85)  {$\frac{2}{2+2}$};
\node[text=teal] at (2.5, 1.85)  {$\frac{2}{3+2}$};
\node[text=teal] at (3.5, 1.85)  {$\frac{2}{4+2}$};

\node[text=teal] at (0.5, 2.85)  {$\frac{3}{1+3}$};
\node[text=teal] at (1.5, 2.85)  {$\frac{3}{2+3}$};
\node[text=teal] at (2.5, 2.85)  {$\frac{3}{3+3}$};
\node[text=teal] at (3.5, 2.85)  {$\frac{3}{4+3}$};


%  probs for vertical lines:
\node[text=teal] at (0.85, 0.5)  {$\frac{1}{1+1}$};
\node[text=teal] at (1.85, 0.5)  {$\frac{2}{2+1}$};
\node[text=teal] at (2.85, 0.5)  {$\frac{3}{3+1}$};
\node[text=teal] at (3.85, 0.5)  {$\frac{4}{4+1}$};

\node[text=teal] at (0.85, 1.5)  {$\frac{1}{1+2}$};
\node[text=teal] at (1.85, 1.5)  {$\frac{2}{2+2}$};
\node[text=teal] at (2.85, 1.5)  {$\frac{3}{3+2}$};
\node[text=teal] at (3.85, 1.5)  {$\frac{4}{4+2}$};

\node[text=teal] at (0.85, 2.5)  {$\frac{1}{1+3}$};
\node[text=teal] at (1.85, 2.5)  {$\frac{2}{2+3}$};
\node[text=teal] at (2.85, 2.5)  {$\frac{3}{3+3}$};
\node[text=teal] at (3.85, 2.5)  {$\frac{4}{4+3}$};

% win probabilities


\node[text=red] at ( 0.8, 0.1)  {$1$};
\node[text=red] at ( 1.8, 0.1)  {$1$};
\node[text=red] at ( 2.8, 0.1)  {$1$};
\node[text=red] at ( 3.8, 0.1)  {$1$};

\node[text=red] at (-0.2, 1.1)  {$0$};
\node[text=red] at ( 0.8, 1.1)  {$\frac{1}{2}$};
\node[text=red] at ( 1.8, 1.1)  {$\frac{5}{6}$};
\node[text=red] at ( 2.8, 1.1)  {$\frac{23}{24}$};
\node[text=red] at ( 3.8, 1.1)  {$\frac{119}{120}$};

\node[text=red] at (-0.2, 2.1)  {$0$};
\node[text=red] at ( 0.8, 2.1)  {$\frac{1}{6}$};
\node[text=red] at ( 1.8, 2.1)  {$\frac{1}{2}$};
\node[text=red] at ( 2.8, 2.1)  {$\frac{31}{40}$};
\node[text=red] at ( 3.8, 2.1)  {$\frac{331}{360}$};

\node[text=red] at (-0.2, 3.1)  {$0$};
\node[text=red] at ( 0.8, 3.1)  {$\frac{1}{24}$};
\node[text=red] at ( 1.8, 3.1)  {$\frac{19}{40}$};
\node[text=red] at ( 2.8, 3.1)  {$\frac{1}{2}$};
\node[text=red] at ( 3.8, 3.1)  {$\frac{233}{315}$};



\end{tikzpicture}
```


$$P(a,b) =
\frac{a}{a+b}P(a,b-1) + \frac{b}{a+b}P(a-1,b)\qquad a,b>0$$

$$P(a,0)=1,a\geqslant 1,
P(0,b)=0,b\geqslant 1
$$




```{tikz, fig.cap = "Partial probability tree for five competitors $a-e$ with $a$ supporting $b$, hyper3 approach", fig.ext = 'png', echo=FALSE}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{patterns}
\newcommand{\arrowIn}{
\tikz \draw[-{Latex[length=4mm]}] (-1pt,0) -- (1pt,0);
}

\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=3cm,y=3cm]

%\fill (0,0) circle[radius=4pt];  % the origin
\fill (1,0) circle[radius=6pt];
\fill (2,0) circle[radius=6pt];
\fill (3,0) circle[radius=6pt];
\fill (4,0) circle[radius=6pt];

\fill (0,1) circle[radius=6pt];
\fill (1,1) circle[radius=3pt];
\fill (2,1) circle[radius=3pt];
\fill (3,1) circle[radius=3pt];
\fill (4,1) circle[radius=3pt];

\fill (0,2) circle[radius=6pt];
\fill (1,2) circle[radius=2pt];
\fill (2,2) circle[radius=2pt];
\fill (3,2) circle[radius=2pt];
\fill (4,2) circle[radius=2pt];

\fill (0,3) circle[radius=6pt];
\fill (1,3) circle[radius=2pt];
\fill (2,3) circle[radius=2pt];
\fill (3,3) circle[radius=2pt];
\fill (4,3) circle[radius=2pt];


% horizontal lines first:

%\draw[line width=0.5mm] (1,0) -- (0,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (2,0) -- (1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (3,0) -- (2,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (4,0) -- (3,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,1) -- (0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,1) -- (1,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,1) -- (2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,1) -- (3,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,2) -- (0,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,2) -- (1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,2) -- (2,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,2) -- (3,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,3) -- (0,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,3) -- (1,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,3) -- (2,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,3) -- (3,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;


% Now vertical lines:
%\draw[line width=0.5mm] (0,1) -- (0,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (0,2) -- (0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
%\draw[line width=0.5mm] (0,3) -- (0,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (1,1) -- (1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (1,2) -- (1,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (1,3) -- (1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (2,1) -- (2,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,2) -- (2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (2,3) -- (2,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (3,1) -- (3,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,2) -- (3,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (3,3) -- (3,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\draw[line width=0.5mm] (4,1) -- (4,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,2) -- (4,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (4,3) -- (4,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;


%\node at (0.2, 0.1)  {$(0,0)$};
\node[text=blue] at (1.2, 0.1)  {$(1,0)$};
\node[text=blue] at (2.2, 0.1)  {$(2,0)$};
\node[text=blue] at (3.2, 0.1)  {$(3,0)$};
\node[text=blue] at (4.2, 0.1)  {$(4,0)$};

\node[text=blue] at (0.2, 1.1)  {$(0,1)$};
\node[text=blue] at (1.2, 1.1)  {$(1,1)$};
\node[text=blue] at (2.2, 1.1)  {$(2,1)$};
\node[text=blue] at (3.2, 1.1)  {$(3,1)$};
\node[text=blue] at (4.2, 1.1)  {$(4,1)$};

\node[text=blue] at (0.2, 2.1)  {$(0,2)$};
\node[text=blue] at (1.2, 2.1)  {$(1,2)$};
\node[text=blue] at (2.2, 2.1)  {$(2,2)$};
\node[text=blue] at (3.2, 2.1)  {$(3,2)$};
\node[text=blue] at (4.2, 2.1)  {$(4,2)$};

\node[text=blue] at (0.2, 3.1)  {$(0,3)$};
\node[text=blue] at (1.2, 3.1)  {$(1,3)$};
\node[text=blue] at (2.2, 3.1)  {$(2,3)$};
\node[text=blue] at (3.2, 3.1)  {$(3,3)$};
\node[text=blue] at (4.2, 3.1)  {$(4,3)$};

%  probs for horizontal lines:
\node[text=teal] at (0.5, 0.85)  {$\frac{1}{2}$};
\node[text=teal] at (1.5, 0.85)  {$\frac{1}{3}$};
\node[text=teal] at (2.5, 0.85)  {$\frac{1}{4}$};
\node[text=teal] at (3.5, 0.85)  {$\frac{1}{5}$};

\node[text=teal] at (0.5, 1.85)  {$\frac{2}{3}$};
\node[text=teal] at (1.5, 1.85)  {$\frac{2}{4}$};
\node[text=teal] at (2.5, 1.85)  {$\frac{2}{5}$};
\node[text=teal] at (3.5, 1.85)  {$\frac{2}{6}$};

\node[text=teal] at (0.5, 2.85)  {$\frac{3}{4}$};
\node[text=teal] at (1.5, 2.85)  {$\frac{3}{5}$};
\node[text=teal] at (2.5, 2.85)  {$\frac{3}{6}$};
\node[text=teal] at (3.5, 2.85)  {$\frac{3}{7}$};


%  probs for vertical lines:
\node[text=teal] at (0.85, 0.5)  {$\frac{1}{2}$};
\node[text=teal] at (1.85, 0.5)  {$\frac{2}{3}$};
\node[text=teal] at (2.85, 0.5)  {$\frac{3}{4}$};
\node[text=teal] at (3.85, 0.5)  {$\frac{4}{5}$};

\node[text=teal] at (0.85, 1.5)  {$\frac{1}{3}$};
\node[text=teal] at (1.85, 1.5)  {$\frac{2}{4}$};
\node[text=teal] at (2.85, 1.5)  {$\frac{3}{5}$};
\node[text=teal] at (3.85, 1.5)  {$\frac{4}{6}$};

\node[text=teal] at (0.85, 2.5)  {$\frac{1}{4}$};
\node[text=teal] at (1.85, 2.5)  {$\frac{2}{5}$};
\node[text=teal] at (2.85, 2.5)  {$\frac{3}{6}$};
\node[text=teal] at (3.85, 2.5)  {$\frac{4}{7}$};

% win probabilities


\node[text=red] at ( 0.8, 0.1)  {$1$};
\node[text=red] at ( 1.8, 0.1)  {$1$};
\node[text=red] at ( 2.8, 0.1)  {$1$};
\node[text=red] at ( 3.8, 0.1)  {$1$};

\node[text=red] at (-0.2, 1.1)  {$0$};
\node[text=red] at ( 0.8, 1.1)  {$\frac{1}{2}$};
\node[text=red] at ( 1.8, 1.1)  {$\frac{5}{6}$};
\node[text=red] at ( 2.8, 1.1)  {$\frac{23}{24}$};
\node[text=red] at ( 3.8, 1.1)  {$\frac{119}{120}$};

\node[text=red] at (-0.2, 2.1)  {$0$};
\node[text=red] at ( 0.8, 2.1)  {$\frac{1}{6}$};
\node[text=red] at ( 1.8, 2.1)  {$\frac{1}{2}$};
\node[text=red] at ( 2.8, 2.1)  {$\frac{31}{40}$};
\node[text=red] at ( 3.8, 2.1)  {$\frac{331}{360}$};

\node[text=red] at (-0.2, 3.1)  {$0$};
\node[text=red] at ( 0.8, 3.1)  {$\frac{1}{24}$};
\node[text=red] at ( 1.8, 3.1)  {$\frac{19}{40}$};
\node[text=red] at ( 2.8, 3.1)  {$\frac{1}{2}$};
\node[text=red] at ( 3.8, 3.1)  {$\frac{233}{315}$};



\end{tikzpicture}
```


```{tikz, fig.cap = "approach", fig.ext = 'png', echo=FALSE}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{patterns}
\newcommand{\arrowIn}{
\tikz \draw[-{Latex[length=4mm]}] (-1pt,0) -- (1pt,0);
}
\newcommand{\half}{$\frac{1}{2}$}

\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=3cm,y=3cm]


\draw[line width=0.5mm] (0,1) -- ( 1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (0,1) -- (-1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill ( 0,1) circle[radius=2pt];
\fill ( 1,0) circle[radius=6pt];
\fill (-1,0) circle[radius=6pt];
\node[text=blue] at (-0.75,0  ) {$(1,0)$};
\node[text=blue] at ( 0.75,0  ) {$(0,1)$};
\node[text=red ] at (-1.0, 0.2)  {$0$};
\node[text=red ] at ( 1.0, 0.2)  {$1$};
\node[text=teal] at (-0.5, 0.7) {\half};
\node[text=teal] at ( 0.5, 0.7) {\half};
\node[text=blue] at ( 0  , 0.8) {$(1,1)$};

\draw[line width=0.5mm] ( 1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,2) -- ( 2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- (-2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- ( 1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- (-1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill (-2,1) circle[radius=6pt];
\fill ( 2,1) circle[radius=6pt];
\fill (-1,2) circle[radius=2pt];
\fill ( 1,2) circle[radius=2pt];
\fill ( 0,3) circle[radius=2pt];
\node[text=red ] at (-2   , 1.2) {$0$};
\node[text=red ] at (-1   , 2.2) {$\frac{1}{6}$};
\node[text=red ] at ( 0   , 1.2) {\half};
\node[text=red ] at ( 1   , 2.2) {$\frac{5}{6}$};
\node[text=red ] at ( 2   , 1.2) {$1$};
\node[text=blue] at (-1.75, 1.0) {$(2,0)$};
\node[text=blue] at (-1   , 1.8) {$(2,1)$};
\node[text=blue] at ( 0.0 , 2.8) {$(2,2)$};
\node[text=blue] at ( 1   , 1.8) {$(1,2)$};
\node[text=blue] at ( 1.75, 1.0) {$(0,2)$};
\node[text=teal] at (-1.5 , 1.7) {$\frac{2}{3}$};
\node[text=teal] at (-0.5 , 1.7) {$\frac{1}{3}$};
\node[text=teal] at ( 0.5 , 1.7) {$\frac{1}{3}$};
\node[text=teal] at ( 1.5 , 1.7) {$\frac{2}{3}$};
\node[text=teal] at (-0.5 , 2.7) {\half};
\node[text=teal] at ( 0.5 , 2.7) {\half};




\draw[line width=0.5mm] ( 1,4) -- ( 0,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,4) -- ( 2,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,4) -- ( 0,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,4) -- (-2,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,5) -- ( 1,4) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,5) -- (-1,4) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill (-2,3) circle[radius=6pt];
\fill ( 2,3) circle[radius=6pt];
\fill (-1,4) circle[radius=2pt];
\fill ( 1,4) circle[radius=2pt];
\fill ( 0,5) circle[radius=2pt];
\node[text=blue] at (-1.75, 3.0) {$(3,1)$};
\node[text=blue] at ( 1.75, 3.0) {$(1,3)$};
\node[text=red ] at (-2   , 3.2) {$0$};
\node[text=red ] at ( 0   , 3.2) {\half};
\node[text=red ] at ( 2   , 3.2) {$1$};
\node[text=red ] at (-1   , 4.2) {$\frac{1}{5}$};
\node[text=red ] at ( 1   , 4.2) {$\frac{4}{5}$};
\node[text=teal] at (-1.5 , 3.7) {$\frac{3}{5}$};
\node[text=teal] at (-0.5 , 3.7) {$\frac{2}{5}$};
\node[text=teal] at ( 0.5 , 3.7) {$\frac{2}{5}$};
\node[text=teal] at ( 1.5 , 3.7) {$\frac{3}{5}$};
\node[text=blue] at (-1   , 3.8) {$(3,2)$};
\node[text=blue] at ( 1   , 3.8) {$(2,3)$};
\node[text=teal] at (-0.5 , 4.7) {\half};
\node[text=teal] at ( 0.5 , 4.7) {\half};
\node[text=blue] at ( 0.0 , 4.8) {$(3,3)$};


\draw[line width=0.5mm] ( 1,6) -- ( 0,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,6) -- ( 2,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,6) -- ( 0,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,6) -- (-2,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,7) -- ( 1,6) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,7) -- (-1,6) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill (-2,5) circle[radius=6pt];
\fill ( 2,5) circle[radius=6pt];
\fill (-1,6) circle[radius=2pt];
\fill ( 1,6) circle[radius=2pt];
\fill ( 0,7) circle[radius=2pt];
\node[text=red ] at (-2   , 5.2) {$0$};
\node[text=red ] at ( 0   , 5.2) {\half};
\node[text=red ] at ( 2   , 5.2) {$1$};
\node[text=red ] at (-1   , 6.2) {$\frac{3}{14}$};
\node[text=red ] at ( 1   , 6.2) {$\frac{11}{14}$};

\node[text=blue] at (-1.75, 5.0) {$(4,2)$};
\node[text=blue] at ( 1.75, 5.0) {$(2,4)$};
\node[text=teal] at (-1.5 , 5.7) {$\frac{4}{7}$};
\node[text=teal] at (-0.5 , 5.7) {$\frac{3}{7}$};
\node[text=teal] at ( 0.5 , 5.7) {$\frac{3}{7}$};
\node[text=teal] at ( 1.5 , 5.7) {$\frac{4}{7}$};
\node[text=blue] at (-1   , 5.8) {$(4,3)$};
\node[text=blue] at ( 1   , 5.8) {$(3,4)$};
\node[text=teal] at (-0.5 , 6.7) {\half};
\node[text=teal] at ( 0.5 , 6.7) {\half};
\node[text=blue] at ( 0.0 , 6.8) {$(4,4)$};


\end{tikzpicture}
```


```{tikz, fig.cap = "approach", fig.ext = 'png', echo=FALSE}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{patterns}
\newcommand{\arrowIn}{\tikz \draw[-{Latex[length=4mm]}] (-1pt,0) -- (1pt,0);}
\newcommand{\half}{$\frac{1}{2}$}

\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=3cm,y=3cm]


\draw[line width=0.5mm] ( 1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,2) -- ( 2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- (-2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- ( 1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- (-1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill (-2,1) circle[radius=6pt];
\fill ( 2,1) circle[radius=6pt];
\fill (-1,2) circle[radius=2pt];
\fill ( 1,2) circle[radius=2pt];
\fill ( 0,3) circle[radius=2pt];
\fill ( 0,1) circle[radius=2pt];
\node[text=red ] at ( 2   , 1.2) {$1$};
\node[text=red ] at (-2   , 1.2) {$0$};
\node[text=red ] at ( 0   , 1.2) {\half};
\node[text=red ] at ( 1   , 2.2) {$\frac{3a-1}{4a-2}$};
\node[text=red ] at (-1   , 2.2) {$\frac{a-1}{4a-2}$};
\node[text=teal] at (-0.5 , 1.7) {$\frac{a-1}{2a-1}$};
\node[text=teal] at ( 0.5 , 1.7) {$\frac{a-1}{2a-1}$};
\node[text=teal] at (-1.5 , 1.7) {$\frac{a}{2a-1}$};
\node[text=teal] at ( 1.5 , 1.7) {$\frac{a}{2a-1}$};
\node[text=blue] at (-1.6 , 1.0) {$(a,a-2)$};
\node[text=blue] at ( 1.6 , 1.0) {$(a-2,a)$};
\node[text=blue] at (-1   , 1.7) {$(a,a-1)$};
\node[text=blue] at ( 1   , 1.7) {$(a-1,a)$};
\node[text=teal] at (-0.5 , 2.7) {\half};
\node[text=teal] at ( 0.5 , 2.7) {\half};
\node[text=blue] at ( 0.0 , 2.8) {$(a,a)$};
\node[text=blue] at ( 0.0 , 0.9){$(a-2,a)$};

\end{tikzpicture}
```

```{tikz, fig.cap = "approach", fig.ext = 'png', echo=FALSE}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{patterns}
\newcommand{\arrowIn}{\tikz \draw[-{Latex[length=4mm]}] (-1pt,0) -- (1pt,0);}
\newcommand{\half}{$\frac{1}{2}$}

\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=3cm,y=3cm]


\draw[line width=0.5mm] ( 1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,2) -- ( 2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- (-2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- ( 1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- (-1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-2,1) -- (-3,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-2,1) -- (-1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 2,1) -- ( 3,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 2,1) -- ( 1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,1) -- (-1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,1) -- ( 1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;

\fill (-3,0) circle[radius=6pt];
\fill (-1,0) circle[radius=2pt];
\fill ( 1,0) circle[radius=2pt];
\fill ( 3,0) circle[radius=6pt];
\fill (-2,1) circle[radius=2pt];
\fill ( 0,1) circle[radius=2pt];
\fill ( 2,1) circle[radius=2pt];
\fill (-1,2) circle[radius=2pt];
\fill ( 1,2) circle[radius=2pt];
\fill ( 0,3) circle[radius=2pt];

\node[text=red ] at (-3 , 0.2) {$0$};
\node[text=red ] at ( 3 , 0.2) {$1$};
\node[text=red ] at (-2 , 1.2) {$\frac{xx}{xx}$};
\node[text=red ] at ( 0 , 1.2) {\half};
\node[text=red ] at ( 2 , 1.2) {$\frac{xx}{xx}$};
\node[text=red ] at (-1 , 2.2) {$\frac{xx}{xx}$};
\node[text=red ] at ( 1 , 2.2) {$\frac{xx}{xx}$};

\node[text=teal] at (-0.5 , 1.7) {$\frac{a-1}{2a-1}$};
\node[text=teal] at ( 0.5 , 1.7) {$\frac{a-1}{2a-1}$};
\node[text=teal] at (-1.5 , 1.7) {$\frac{a  }{2a-1}$};
\node[text=teal] at ( 1.5 , 1.7) {$\frac{a  }{2a-1}$};
\node[text=teal] at (-1.5 , 0.7) {$\frac{a-2}{2a-2}$};
\node[text=teal] at ( 1.5 , 0.7) {$\frac{a  }{2a-2}$};
\node[text=teal] at (-2.5 , 0.7) {$\frac{a  }{2a-2}$};
\node[text=teal] at ( 2.5 , 0.7) {$\frac{a-2}{2a-2}$};
\node[text=teal] at (-0.5 , 2.7) {\half};
\node[text=teal] at ( 0.5 , 2.7) {\half};
\node[text=teal] at (-0.5 , 0.7) {\half};
\node[text=teal] at ( 0.5 , 0.7) {\half};

\node[text=blue] at (-3 ,-0.2) {$(a  ,a-3)$};
\node[text=blue] at (-1 ,-0.2) {$(a-1,a-2)$};
\node[text=blue] at ( 1 ,-0.2) {$(a-2,a-1)$};
\node[text=blue] at ( 3 ,-0.2) {$(a-3,a  )$};
\node[text=blue] at ( 0 , 0.6) {$(a-1,a-1)$};
\node[text=blue] at (-2 , 0.7) {$(a  ,a-2)$};
\node[text=blue] at (-1 , 1.7) {$(a  ,a-1)$};
\node[text=blue] at ( 1 , 1.7) {$(a-1,a  )$};
\node[text=blue] at ( 2 , 0.7) {$(a-2,a  )$};
\node[text=blue] at ( 0 , 2.8) {$(a  ,a  )$};

\end{tikzpicture}
```





```{tikz, fig.cap = "approach", fig.ext = 'png', echo=FALSE}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{patterns}
\newcommand{\arrowIn}{
\tikz \draw[-{Latex[length=4mm]}] (-1pt,0) -- (1pt,0);
}
\newcommand{\half}{$\frac{1}{2}$}

\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=3cm,y=3cm]


\draw[line width=0.5mm] (0,1) -- ( 1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (0,1) -- (-1,0) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill ( 1,0) circle[radius=6pt];
\fill (-1,0) circle[radius=6pt];
\fill ( 0,1) circle[radius=2pt];
\node[text=red ] at (-1.0, 0.2)  {$0$};
\node[text=red ] at ( 1.0, 0.2)  {$1$};
\node[text=blue] at (-0.75,0  ) {$(1,0)$};
\node[text=blue] at ( 0.75,0  ) {$(0,1)$};
\node[text=blue] at ( 0  , 0.8) {$(1,1)$};
\node[text=teal] at (-0.5, 0.7) {\half};
\node[text=teal] at ( 0.5, 0.7) {\half};



\draw[line width=0.5mm] ( 1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,2) -- ( 2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- ( 0,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,2) -- (-2,1) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- ( 1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,3) -- (-1,2) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill (-2,1) circle[radius=6pt];
\fill ( 2,1) circle[radius=6pt];
\fill (-1,2) circle[radius=2pt];
\fill ( 1,2) circle[radius=2pt];
\fill ( 0,3) circle[radius=2pt];
\node[text=red ] at (-2   , 1.2) {$0$};
\node[text=red ] at (-1   , 2.2) {$\frac{1}{6}$};
\node[text=red ] at ( 0   , 1.2) {\half};
\node[text=red ] at ( 1   , 2.2) {$\frac{5}{6}$};
\node[text=red ] at ( 2   , 1.2) {$1$};
\node[text=blue] at (-1.75, 1.0) {$(2,0)$};
\node[text=blue] at (-1   , 1.8) {$(2,1)$};
\node[text=blue] at ( 0.0 , 2.8) {$(2,2)$};
\node[text=blue] at ( 1   , 1.8) {$(1,2)$};
\node[text=blue] at ( 1.75, 1.0) {$(0,2)$};
\node[text=teal] at (-1.5 , 1.7) {$\frac{2}{3}$};
\node[text=teal] at (-0.5 , 1.7) {$\frac{1}{3}$};
\node[text=teal] at ( 0.5 , 1.7) {$\frac{1}{3}$};
\node[text=teal] at ( 1.5 , 1.7) {$\frac{2}{3}$};
\node[text=teal] at (-0.5 , 2.7) {\half};
\node[text=teal] at ( 0.5 , 2.7) {\half};




\draw[line width=0.5mm] ( 1,4) -- ( 0,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,4) -- ( 2,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,4) -- ( 0,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,4) -- (-2,3) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,5) -- ( 1,4) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,5) -- (-1,4) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill (-2,3) circle[radius=6pt];
\fill ( 2,3) circle[radius=6pt];
\fill (-1,4) circle[radius=2pt];
\fill ( 1,4) circle[radius=2pt];
\fill ( 0,5) circle[radius=2pt];
\node[text=red ] at (-2   , 3.2) {$0$};
\node[text=red ] at ( 0   , 3.2) {\half};
\node[text=red ] at ( 2   , 3.2) {$1$};
\node[text=red ] at (-1   , 4.2) {$\frac{1}{5}$};
\node[text=red ] at ( 1   , 4.2) {$\frac{4}{5}$};
\node[text=blue] at (-1.75, 3.0) {$(3,1)$};
\node[text=blue] at ( 1.75, 3.0) {$(1,3)$};
\node[text=blue] at (-1   , 3.8) {$(3,2)$};
\node[text=blue] at ( 1   , 3.8) {$(2,3)$};
\node[text=teal] at (-1.5 , 3.7) {$\frac{3}{5}$};
\node[text=teal] at (-0.5 , 3.7) {$\frac{2}{5}$};
\node[text=teal] at ( 0.5 , 3.7) {$\frac{2}{5}$};
\node[text=teal] at ( 1.5 , 3.7) {$\frac{3}{5}$};
\node[text=teal] at (-0.5 , 4.7) {\half};
\node[text=blue] at ( 0.0 , 4.8) {$(3,3)$};
\node[text=teal] at ( 0.5 , 4.7) {\half};


\draw[line width=0.5mm] ( 1,6) -- ( 0,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 1,6) -- ( 2,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,6) -- ( 0,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] (-1,6) -- (-2,5) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,7) -- ( 1,6) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\draw[line width=0.5mm] ( 0,7) -- (-1,6) node[sloped, pos=0.5, allow upside down]{\arrowIn}; ;
\fill (-2,5) circle[radius=6pt];
\fill ( 2,5) circle[radius=6pt];
\fill (-1,6) circle[radius=2pt];
\fill ( 1,6) circle[radius=2pt];
\fill ( 0,7) circle[radius=2pt];
\node[text=blue] at (-1.75, 5.0) {$(4,2)$};
\node[text=blue] at ( 1.75, 5.0) {$(2,4)$};
\node[text=red ] at (-2   , 5.2) {$0$};
\node[text=red ] at ( 0   , 5.2) {\half};
\node[text=red ] at ( 2   , 5.2) {$1$};
\node[text=blue] at (-1   , 5.8) {$(4,3)$};
\node[text=blue] at ( 1   , 5.8) {$(3,4)$};
\node[text=red ] at (-1   , 6.2) {$\frac{3}{14}$};
\node[text=red ] at ( 1   , 6.2) {$\frac{11}{14}$};
\node[text=teal] at (-1.5 , 5.7) {$\frac{4}{7}$};
\node[text=teal] at (-0.5 , 5.7) {$\frac{3}{7}$};
\node[text=teal] at ( 0.5 , 5.7) {$\frac{3}{7}$};
\node[text=teal] at ( 1.5 , 5.7) {$\frac{4}{7}$};
\node[text=teal] at (-0.5 , 6.7) {\half};
\node[text=blue] at ( 0.0 , 6.8) {$(4,4)$};
\node[text=teal] at ( 0.5 , 6.7) {\half};


\end{tikzpicture}
```





```{r calcarray,cache=TRUE}
options(digits=4)
n <- 40
A <- matrix(NA,n,n)
A[1,] <- 1/factorial(seq_len(n) + 1)
A[,1] <- 1-A[1,]
for(i in 2:n){
  for(j in 2:n){
     A[i,j] <- i/(i+j)*A[i,j-1] + j/(i+j)*A[i-1,j]
  }
}
```

```{r plotA}
matplot(A,type='l',lty=1)
matplot(log(A/(1-A)),type="l",ylim=c(-10,10),lty=1,main="round-off error for p ~= 1")
contour(log(A),asp=1)
contour(log(A/(1-A)),asp=1)
matplot(A + t(A)-1)
N <- seq_len(n-1)
plot(N,A[cbind(N,N+1)])
delta <- A[cbind(N+1,N)]-0.5
plot(N,log(delta),ylim=c(-3,0))
points(N,-log(N)/2-1/sqrt(2),type='l')
approx <- exp(-1/sqrt(2))/sqrt(N)
plot(N,approx/delta)
```
